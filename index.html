<!doctype html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Verification Gate Process...</title>
        <!-- Memuat Tailwind CSS -->
<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  
        <!-- Memuat Font Inter (Alternatif Google Sans yang gratis dan sangat mirip) -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />

        <style>
            /* Menerapkan font Inter ke seluruh halaman */
            body {
                font-family: "Inter", sans-serif;
            }
            /* Animasi sederhana untuk menggoyangkan input jika salah */
            @keyframes shake {
                0%,
                100% {
                    transform: translateX(0);
                }
                10%,
                30%,
                50%,
                70%,
                90% {
                    transform: translateX(-5px);
                }
                20%,
                40%,
                60%,
                80% {
                    transform: translateX(5px);
                }
            }
            .shake {
                animation: shake 0.5s ease-in-out;
            }
        </style>
    </head>
    <body
        class="bg-slate-900 text-white flex items-center justify-center min-h-screen p-4"
    >
        <div
            class="bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl p-8 w-full max-w-md space-y-6"
        >
            <!-- Header -->
            <div>
                <div
                    class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-600"
                >
                    <!-- Ikon Perisai sebagai simbol verifikasi -->
                    <svg
                        class="h-6 w-6 text-white"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286zm0 13.036h.008v.008h-.008v-.008z"
                        />
                    </svg>
                </div>
                <h1 id="main-title" class="text-center text-2xl font-bold mt-4">
                    Verifikasi Diri Anda
                </h1>
                <p id="main-subtitle" class="text-center text-slate-400 mt-2">
                    Untuk melanjutkan, selesaikan captcha di bawah ini.
                </p>
            </div>

            <!-- Konten Verifikasi (Awalnya disembunyikan) -->
            <div id="verification-content" class="hidden space-y-4">
                <!-- Canvas untuk Captcha -->
                <div
                    class="flex items-center justify-center gap-4 bg-slate-900 p-3 rounded-lg"
                >
                    <canvas
                        id="captchaCanvas"
                        width="200"
                        height="70"
                        class="rounded-md"
                    ></canvas>
                    <button
                        id="refreshCaptcha"
                        title="Buat captcha baru"
                        class="p-2 rounded-full hover:bg-slate-700 transition-colors"
                    >
                        <svg
                            class="w-6 h-6 text-slate-400"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0l3.181-3.183m-3.181-3.182l-3.182 3.182a8.25 8.25 0 01-11.664 0l-3.182-3.182m3.182-3.182h-4.992m4.992 0v4.992"
                            />
                        </svg>
                    </button>
                </div>

                <!-- Input Captcha -->
                <div>
                    <input
                        type="text"
                        id="captchaInput"
                        placeholder="Masukkan teks di atas..."
                        class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                    />
                </div>

                <!-- Tombol Verifikasi -->
                <button
                    id="verifyButton"
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-slate-800 disabled:bg-slate-600 disabled:cursor-not-allowed"
                >
                    Verifikasi
                </button>
            </div>

            <!-- Pesan Status/Error -->
            <div id="message" class="hidden text-center p-3 rounded-lg"></div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // Mengambil elemen dari DOM
                const canvas = document.getElementById("captchaCanvas");
                const ctx = canvas.getContext("2d");
                const captchaInput = document.getElementById("captchaInput");
                const verifyButton = document.getElementById("verifyButton");
                const refreshCaptcha =
                    document.getElementById("refreshCaptcha");
                const messageDiv = document.getElementById("message");
                const verificationContent = document.getElementById(
                    "verification-content"
                );
                const mainTitle = document.getElementById("main-title");
                const mainSubtitle = document.getElementById("main-subtitle");

                let captchaText = "";
                let userId = null;
                let guildId = null;

                // Fungsi untuk mengambil parameter dari URL
                const getUrlParams = () => {
                    const params = new URLSearchParams(window.location.search);
                    userId = params.get("userId");
                    guildId = params.get("guildId");

                    if (!userId || !guildId) {
                        mainTitle.textContent = "URL Tidak Valid";
                        mainSubtitle.textContent =
                            "Pastikan Anda membuka link ini dari Discord. Silakan coba lagi.";
                        showMessage(
                            "error",
                            "Parameter userId atau guildId tidak ditemukan."
                        );
                        return false;
                    }
                    verificationContent.classList.remove("hidden");
                    return true;
                };

                // Fungsi untuk membuat captcha baru
                const generateCaptcha = () => {
                    captchaText = "";
                    const chars =
                        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
                    for (let i = 0; i < 6; i++) {
                        captchaText += chars.charAt(
                            Math.floor(Math.random() * chars.length)
                        );
                    }

                    // Menggambar captcha di canvas
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = "#1e293b"; // Latar belakang canvas
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // Tambahkan noise garis
                    for (let i = 0; i < 5; i++) {
                        ctx.strokeStyle = `rgba(100, 116, 139, ${
                            Math.random() * 0.5
                        })`;
                        ctx.beginPath();
                        ctx.moveTo(
                            Math.random() * canvas.width,
                            Math.random() * canvas.height
                        );
                        ctx.lineTo(
                            Math.random() * canvas.width,
                            Math.random() * canvas.height
                        );
                        ctx.stroke();
                    }

                    // Menggambar teks captcha
                    ctx.font = "bold 36px Inter";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillStyle = "#cbd5e1";
                    ctx.fillText(
                        captchaText,
                        canvas.width / 2,
                        canvas.height / 2
                    );
                };

                // Fungsi untuk menampilkan pesan status
                const showMessage = (type, text) => {
                    messageDiv.classList.remove(
                        "hidden",
                        "bg-green-500/20",
                        "text-green-300",
                        "bg-red-500/20",
                        "text-red-300"
                    );
                    if (type === "success") {
                        messageDiv.classList.add(
                            "bg-green-500/20",
                            "text-green-300"
                        );
                    } else {
                        messageDiv.classList.add(
                            "bg-red-500/20",
                            "text-red-300"
                        );
                    }
                    messageDiv.textContent = text;
                };

                // Fungsi untuk menangani proses verifikasi
                const handleVerification = async () => {
                    const userInput = captchaInput.value.trim();

                    if (userInput.toLowerCase() !== captchaText.toLowerCase()) {
                        showMessage(
                            "error",
                            "Captcha salah, silakan coba lagi."
                        );
                        captchaInput.classList.add("shake");
                        setTimeout(
                            () => captchaInput.classList.remove("shake"),
                            500
                        );
                        generateCaptcha();
                        captchaInput.value = "";
                        return;
                    }

                    // Menonaktifkan tombol saat proses
                    verifyButton.disabled = true;
                    verifyButton.textContent = "Memverifikasi...";
                    messageDiv.classList.add("hidden");

                    // --- SIMULASI PANGGILAN KE BACKEND ---
                    // Di aplikasi nyata, bagian ini akan diganti dengan `fetch()` ke server/backend Anda.
                    // Backend Anda kemudian akan berkomunikasi dengan bot Discord untuk memberikan role.
                    console.log("Mengirim data ke backend (simulasi):");
                    console.log(`User ID: ${userId}`);
                    console.log(`Guild ID: ${guildId}`);

                    setTimeout(() => {
                        // Jika backend merespon sukses:
                        verificationContent.classList.add("hidden");
                        mainTitle.textContent = "Verifikasi Berhasil!";
                        mainSubtitle.textContent =
                            "Anda sekarang bisa menutup halaman ini dan kembali ke Discord.";
                        showMessage(
                            "success",
                            "Role Anda telah berhasil ditambahkan."
                        );
                    }, 2000); // Simulasi delay jaringan selama 2 detik
                };

                // Menambahkan event listener
                refreshCaptcha.addEventListener("click", generateCaptcha);
                verifyButton.addEventListener("click", handleVerification);
                captchaInput.addEventListener("keyup", event => {
                    if (event.key === "Enter") {
                        handleVerification();
                    }
                });

                // Inisialisasi halaman
                if (getUrlParams()) {
                    generateCaptcha();
                }
            });
        </script>
    </body>
</html>
